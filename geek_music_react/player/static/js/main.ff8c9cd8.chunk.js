(this.webpackJsonpgeek_music_react=this.webpackJsonpgeek_music_react||[]).push([[0],{180:function(e,t,a){e.exports=a(361)},185:function(e,t,a){},31:function(e,t,a){e.exports=a.p+"static/media/lizhi.cbb70be5.png"},312:function(e,t,a){},313:function(e,t,a){},316:function(e,t,a){},318:function(e,t,a){},319:function(e,t,a){},361:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),s=a(3),i=a.n(s),r=(a(185),a(6)),l=a(7),c=a(11),u=a(12),m=a(4),d=a(10),h=a(25),p=a(364),f=a(366),g=a(38),v=a(149),y=a.n(v),N=a(150),E=a.n(N);function b(){this.count=0,this.el=document.querySelector("#loading")}b.prototype.show=function(){this.count++,1===this.count&&(this.el.style.display="flex")},b.prototype.hide=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";"all"===t?this.count=0:this.count>0&&this.count--,setTimeout((function(){0===e.count&&(e.el.style.display="none")}),300)};var k=new b;var S=function(e){var t=e.method||"get",a=e.data||"",n=e.url,o=e.showLoading||!1;return new Promise((function(e,s){o&&k.show(),y()({method:t,url:n,data:E.a.stringify(a)}).then((function(t){k.hide(),e(t)})).catch((function(e){k.hide(),s(e)}))}))},C=new(function(){function e(){Object(r.a)(this,e)}return Object(l.a)(e,[{key:"show",value:function(e,t){var a=this,n=document.querySelector("body").querySelector("#my-alert");if(n){n.style.display="flex",n.querySelector("p").innerText=e,t&&setTimeout((function(){a.hide()}),t)}else{var o=document.createElement("div"),s=document.createElement("p");o.id="my-alert",s.className="my-alert-p",s.innerText=e,o.appendChild(s),document.querySelector("body").appendChild(o),t&&setTimeout((function(){a.hide()}),t)}}},{key:"hide",value:function(){var e=document.querySelector("body").querySelector("#my-alert");e&&(e.style.display="none")}}]),e}()),w=a(31),I=a.n(w),L=a(62),j=a.n(L),O=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).debounce=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;return function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];var i=o;n.state.timerId&&clearTimeout(n.state.timerId),n.setState({timerId:setTimeout((function(){e.apply(Object(h.a)(n),i)}),t)})}},n.onDebounceKeyUpClick=function(e){e.persist(),n.debounce(n.checkUserName,800)(e)},n.state={curPage:"/login",timerId:null},n}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("div",{className:"login-register-wrapper"},o.a.createElement("div",{className:"content"},o.a.createElement("div",{className:"title"},o.a.createElement("img",{className:"logo-img",src:I.a,alt:""}),o.a.createElement("p",null,"Geek Music")),o.a.createElement(p.a,{name:"basic",initialValues:{remember:!0},onFinish:this.submitHandler.bind(this)},o.a.createElement(p.a.Item,{name:"username",label:"Username",className:"label",getValueFromEvent:function(e){return e.target.value.replace(/[\u4E00-\u9FA5]/g,"")},rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"},{validator:function(e,t){return void 0!==t?t.length>0?Promise.resolve():Promise.reject("\u8d26\u53f7\u957f\u5ea6\u4e0d\u5f97\u5c0f\u4e8e1\u4f4d!"):Promise.reject("\u8d26\u53f7\u4e0d\u5f97\u4e3a\u7a7a!")}}]},o.a.createElement(f.a,null)),this.genNickName(),o.a.createElement(p.a.Item,{label:"Password",name:"password",className:"label",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801"}]},o.a.createElement(f.a.Password,{className:"ipt"})),this.genLoginBtn(),this.genRegisterBtn())))}},{key:"componentDidMount",value:function(){var e=this;this.setCurPageState(),setTimeout((function(){console.log(e.props.match)}),1e3)}},{key:"setCurPageState",value:function(){-1!==this.props.match.url.indexOf("login")?this.setState({curPage:"/login"}):this.setState({curPage:"/register"})}},{key:"checkUserName",value:function(e){if("/register"===this.getCurPage()){console.log("\u5728\u6ce8\u518c\u9875");var t=e.target.value;console.log(e.target.value),S({data:{regName:t},method:"post",url:"/register/user_register/checkname.music"}).then((function(e){1===e.data.code?C.show(e.data.val,2500):console.log("\u7528\u6237\u540d\u53ef\u7528")})).catch((function(e){}))}}},{key:"genLoginBtn",value:function(){var e=this;return"/login"===this.getCurPage()?o.a.createElement(p.a.Item,null,o.a.createElement(g.a,{size:"large",block:!0,className:"login",type:"primary",htmlType:"submit"},"\u767b\u5f55")):o.a.createElement(p.a.Item,null,o.a.createElement(g.a,{size:"large",block:!0,className:"login",type:"primary",onClick:function(){return e.props.history.push("/login")}},"\u5df2\u6709\u8d26\u53f7\uff1f",o.a.createElement("span",{className:"click-me"}," \u70b9\u6211 ")," \u767b\u9646"))}},{key:"genRegisterBtn",value:function(){var e=this;return"/login"===this.getCurPage()?o.a.createElement(p.a.Item,null,o.a.createElement(g.a,{size:"large",block:!0,className:"register",type:"primary",onClick:function(){return e.props.history.push("/register")}},"\u8fd8\u6ca1\u6709\u8d26\u53f7\uff1f ",o.a.createElement("span",{className:"click-me"},"\u53bb\u6ce8\u518c"))):o.a.createElement(p.a.Item,null,o.a.createElement(g.a,{size:"large",block:!0,className:"register",type:"primary",htmlType:"submit"},"\u786e\u8ba4\u6ce8\u518c"))}},{key:"genNickName",value:function(){return"/login"===this.getCurPage()?"":o.a.createElement(p.a.Item,{label:"Nickname",name:"nickname",className:"label"},o.a.createElement(f.a,{className:"ipt"}))}},{key:"getCurPage",value:function(){return-1!==this.state.curPage.indexOf("login")?"/login":"/register"}},{key:"submitHandler",value:function(e){var t,a=e.username,n=j()(e.password);"/login"===this.getCurPage()?(t={method:"post",data:{userName:a,pwd:n},url:"/login/user_login.music"},this.loginHandler(t)):(t={method:"post",data:{userName:a,nickname:e.nickname,pwd:n},url:"/register/user_register.music"},this.registerHandler(t))}},{key:"loginHandler",value:function(e){var t=this;S(e).then((function(e){var a=e.data;0!==a.code?C.show(a.val,3e3):(t.props.setUserInfo(a.userInfo),t.props.setAuthed(!0),t.props.goToLogin(!1),t.props.history.replace("/index"))})).catch((function(e){console.log(e)}))}},{key:"registerClickHandler",value:function(){this.props.history.push("/register")}},{key:"registerHandler",value:function(e){var t=this;S(e).then((function(e){0!==e.data.code?C.show(e.data.val,2500):(C.show("\u6ce8\u518c\u6210\u529f\uff0c\u5373\u5c06\u8df3\u8f6c\u5230\u767b\u5f55\u9875",2e3),setTimeout((function(){t.props.history.push("/login")}),2e3)),console.log(e)})).catch((function(e){console.log(e)}))}}]),a}(n.Component),P=Object(d.b)((function(e){return e}),(function(e){return{goToLogin:function(t){e({type:"goToLogin",toLogin:t})},setUserInfo:function(t){e({type:"userInfo",userInfo:t})},setAuthed:function(t){e({type:"authed",authed:t})}}}),null,{forwardRef:!0})(O),A=a(20),T=a.n(A);a(312);function x(e){var t=Math.floor(e/60),a=(e-60*t).toFixed(0);return a<10?"".concat(t,":0").concat(a):"".concat(t,":").concat(a)}var H=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).optionClickHandler=n.optionClickHandler.bind(Object(h.a)(n)),n.state={duration:0,curTime:0,curList:"allList",curPlayingTimePercent:0,curState:!1,canvas:null,timerId:null,isNoVoice:!1,curVolume:.5},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=this.props.playerCom.optionMenus.map((function(t,a){var n="option "+t.option;-1!==t.option.indexOf("play")&&1===e.props.isPlaying&&(n="option "+t.option+" hide"),-1!==t.option.indexOf("paused")&&2===e.props.isPlaying&&(n="option "+t.option+" hide");var s="iconfont "+t.iconfont;return o.a.createElement("div",{title:t.toolTip,key:a,className:n,onClick:e.optionClickHandler},o.a.createElement("i",{className:s}))}));return o.a.createElement("div",{className:"player"},o.a.createElement("div",{className:"content"},o.a.createElement("audio",{id:"audio",className:"audio-tag",ref:"audio",onEnded:this.audioEnded.bind(this),onLoadedMetadata:this.loadMetaData.bind(this),onTimeUpdate:this.timeUpdateHandler.bind(this),onDurationChange:this.durationChangeHandler.bind(this),controls:!0}),o.a.createElement("div",{className:"player-ui"},o.a.createElement("div",{className:"top"},o.a.createElement("div",{className:"top-left"},o.a.createElement("canvas",{id:"canvas"})),o.a.createElement("div",{className:"common-list top-right"},o.a.createElement("h5",{className:"comments-title"},"\u70ed\u95e8\u8bc4\u8bba"),o.a.createElement("ul",null,this.genCommentListDom()),o.a.createElement("div",{className:"comment-area"},o.a.createElement("div",{className:"ipt-container"},o.a.createElement("label",{htmlFor:"comment"},"\u53d1\u8868\u8bc4\u8bba\uff1a"),o.a.createElement("div",{className:"textarea-btn-container"},o.a.createElement("textarea",{name:"",id:"comment",ref:"commentArea",placeholder:"\u8bf7\u7559\u4e0b\u60a8\u7684\u8bc4\u8bba"}),o.a.createElement("button",{className:"comment-btn",onClick:this.submitComment.bind(this)},"\u8bc4\u8bba")))))),o.a.createElement("div",{className:this.props.searchList.length?"middle search-result":"hide"},o.a.createElement("span",{onClick:this.closeSearchResult.bind(this),className:"close-x"},"\xd7"),o.a.createElement("h5",{className:"sr-res-title"},"\u641c\u7d22\u7ed3\u679c"),o.a.createElement("ul",{className:"ul"},this.props.searchList.map((function(t,a){return o.a.createElement("li",{className:e.props.curSongInfo.id===t.id?"active":"",onClick:e.getAudioStream.bind(e,t,"search"),key:a},t.fileNameChinese)})))),o.a.createElement("div",{className:"bottom"},o.a.createElement("div",{className:"process-container",onClick:this.processContainerClickHandler.bind(this)},o.a.createElement("div",{ref:"processBar",className:"process-bar"},o.a.createElement("span",{className:"dot"}))),o.a.createElement("div",{className:"fragment"},o.a.createElement("div",{className:"song-info"},o.a.createElement("img",{className:"info-left",src:I.a,alt:""}),o.a.createElement("div",{className:"info-right"},o.a.createElement("p",{className:"song-album-name"},o.a.createElement("span",null,this.props.curSongInfo.fileNameChinese),o.a.createElement("span",null,this.props.curSongInfo.albumChinese)),o.a.createElement("p",{className:this.props.curSongInfo.id?"duration-time":"hide"},x(this.state.curTime)," /"," ",x(this.state.duration)))),o.a.createElement("div",{className:"controls"},o.a.createElement("div",{className:"wrapper"},t,o.a.createElement("div",{className:"option volume",onClick:this.closeVolume.bind(this)},o.a.createElement("i",{className:this.state.isNoVoice?"iconfont icon-jingyin1":"iconfont icon-shengyin"}),o.a.createElement("div",{onClick:this.setVolume.bind(this),className:"vertical-container"},o.a.createElement("div",{className:"vertical-bar",style:{height:100*this.state.curVolume+"%"}},o.a.createElement("div",{className:"dot"})))))))))))}},{key:"componentDidMount",value:function(){this.initCanvasAndAudioContext()}},{key:"closeVolume",value:function(){var e=this,t=this.state.isNoVoice;this.setState({isNoVoice:!t},(function(){e.state.isNoVoice?e.refs.audio.volume=0:e.refs.audio.volume=e.state.curVolume}))}},{key:"setVolume",value:function(e){this.state.isNoVoice&&this.setState({isNoVoice:!1}),e.stopPropagation();var t=this.mouseCoords(e).y,a=T()(e.currentTarget).offset().top,n=T()(e.currentTarget).height(),o=t-a,s=100*(1-o/n).toFixed(2);T()(".vertical-bar").height(s+"%"),this.refs.audio.volume=Number((1-o/n).toFixed(2)),console.log(this.refs.audio.volume),this.setState({curVolume:Number((1-o/n).toFixed(2))})}},{key:"closeSearchResult",value:function(){document.querySelector("#search-val").value="",this.props.setSearchResult([])}},{key:"genCommentListDom",value:function(){return this.props.commentList.length?this.props.commentList.map((function(e,t){return o.a.createElement("li",{key:t},e.commentContent,o.a.createElement("i",{className:"iconfont icon-xin"}))})):o.a.createElement("div",{className:"has-no-comment"},o.a.createElement("label",{htmlFor:"comment"},"\u6682\u65e0\u8bc4\u8bba\uff0c\u5feb\u6765\u62a2\u6c99\u53d1\u5427\uff01"))}},{key:"audioEnded",value:function(){this.props.setPlayingState(2),this.playNextSong()}},{key:"submitComment",value:function(){var e=this;if(this.props.authed){var t=this.refs.commentArea.value;if(t){var a={method:"post",url:"/comments/songComments.music",data:{userId:this.props.userInfo.id||3,userName:"GeekChen",songId:this.props.curSongInfo.id,commentContent:t,type:"1"}};S(a).then((function(t){console.log(t),0===t.data.code&&(C.show("\u8bc4\u8bba\u6210\u529f",2500),e.getSongComments(),e.refs.commentArea.value="")})).catch((function(e){C.show("\u63d0\u4ea4\u8bc4\u8bba\u5931\u8d25",2500),console.log(e)}))}else C.show("\u8bf7\u8f93\u5165\u60a8\u7684\u8bc4\u8bba",2e3)}else C.show("\u6b64\u529f\u80fd\u9700\u767b\u5f55\u540e\u4f7f\u7528",2500)}},{key:"getSongComments",value:function(){var e=this;console.log(this.props.curSongInfo.id);var t={method:"post",url:"/comments/getSongComments.music",data:{userId:this.props.userInfo.id||3,songId:this.props.curSongInfo.id,type:"1"}};S(t).then((function(t){if(console.log(t),0===t.data.code){var a=t.data.data.sort((function(e,t){return t.id-e.id}));console.log(a),e.props.sendCommentList(t.data.data)}})).catch((function(e){C.show("\u83b7\u53d6\u8bc4\u8bba\u5931\u8d25",2500),console.log(e)}))}},{key:"initCanvasAndAudioContext",value:function(){var e=document.getElementById("audio"),t=document.getElementById("canvas"),a=t.getContext("2d");t.width=window.innerWidth,t.height=window.innerHeight;var n=t.width,o=t.height;e.load();var s=new AudioContext,i=s.createMediaElementSource(e),r=s.createAnalyser();i.connect(r),r.connect(s.destination),r.fftSize=128;var l,c=r.frequencyBinCount,u=n/c-1,m=new Uint8Array(c);!function e(){console.log("renderFrame"),requestAnimationFrame(e),a.fillStyle="#ACCAF8",a.fillRect(0,0,n,o),r.getByteFrequencyData(m);for(var t=0,s=0;s<c;s++){var i=m[s]/255;l=o*i;var d=255*i,h=255*(s/c);a.fillStyle="rgb("+d+","+h+",50)",a.fillRect(t,o-l,u,l),t+=u+1}}()}},{key:"processContainerClickHandler",value:function(e){var t=this;e.stopPropagation();var a=100*((this.mouseCoords(e).x-T()(e.currentTarget).offset().left)/T()(e.currentTarget).width()).toFixed(2);T()(".process-bar").width(a+"%"),this.setState({curPlayingTimePercent:a},(function(){t.setAudioCurPlayingTime()}))}},{key:"mouseCoords",value:function(e){return e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:{x:e.clientX+document.body.scrollLeft-document.body.clientLeft,y:e.clientY+document.body.scrollTop-document.body.clientTop}}},{key:"setAudioCurPlayingTime",value:function(){this.setState({curState:!0});var e=(this.state.curPlayingTimePercent/100*this.state.duration).toFixed(2),t=this.refs.audio;console.log(t),t.currentTime=e}},{key:"getAudioStream",value:function(e,t){var a=this,n=this.props.curSongInfo.id;if(e.id!==n||1!==this.props.isPlaying){this.setState({curList:t}),this.props.sendCurSongInfo(e),this.props.setPlayingState(1),setTimeout((function(){a.getSongComments()}),0),console.log(t);var o="".concat(e.albumName,"/").concat(e.fileName),s=document.querySelector("#audio");s.src="/src/getSongStream.music?url="+o,s.play()}}},{key:"optionClickHandler",value:function(e){var t=e.currentTarget;T()(t).siblings().removeClass("active").end().addClass("active"),T()(t).hasClass("collect")?(console.log("collect"),this.collectSongBySongId()):T()(t).hasClass("prev")?this.playPrevSong():T()(t).hasClass("paused")?(console.log("paused"),this.pauseTheSong()):T()(t).hasClass("play")?(console.log("play"),this.playTheSong()):T()(t).hasClass("next")?this.playNextSong():T()(t).hasClass("share")&&this.shareMusic()}},{key:"playNextSong",value:function(){var e=this,t=this.state.curList,a=this.props.curSongInfo.id;if(console.log("curSongId:-----",a),"allList"===t){var n=this.props.allList;n.forEach((function(t,o){if(Array.isArray(t.children)){var s=t.children;s.forEach((function(t,i){if(t.id===a)if(i<s.length-1){var r=s[i+1];e.getAudioStream(r,"allList"),e.props.sendCurSongInfo(r)}else if(o<n.length-1){var l=n[o+1].children[0];e.getAudioStream(l,"allList"),e.props.sendCurSongInfo(l)}else C.show("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9996\u5566",2e3)}))}}))}else if("collect"===t){var o=this.props.collectList;o.forEach((function(t,n){if(a===t.id)if(n<o.length-1){var s=o[n+1];e.getAudioStream(s,"collect"),e.props.sendCurSongInfo(s)}else C.show("\u5df2\u7ecf\u662f\u60a8\u6536\u85cf\u7684\u5b9d\u8d1d\u6b4c\u5355\u7684\u6700\u540e\u4e00\u9996\u5566",2e3)}))}else if("search"===t)for(var s=this.props.searchList,i=0;i<s.length;i++){if(s[i].id===a)if(i<s.length-1){var r=s[i+1];this.getAudioStream(r,"search"),this.props.sendCurSongInfo(r)}else C.show("\u5df2\u7ecf\u662f\u60a8\u641c\u7d22\u7684\u5b9d\u8d1d\u6b4c\u5355\u7684\u6700\u540e\u4e00\u9996\u5566",2e3)}}},{key:"playPrevSong",value:function(){var e=this,t=this.state.curList,a=this.props.curSongInfo.id;if("allList"===t){var n=this.props.allList;n.forEach((function(t,o){if(Array.isArray(t.children)){var s=t.children;s.forEach((function(t,i){if(t.id===a)if(0!==i){var r=s[i-1];e.getAudioStream(r,"allList"),e.props.sendCurSongInfo(r)}else if(0!==o){var l=n[o-1].children[0];e.getAudioStream(l,"allList"),e.props.sendCurSongInfo(l)}else C.show("\u5df2\u7ecf\u662f\u6b4c\u5355\u7684\u7b2c\u4e00\u9996\u5566",2e3)}))}}))}else if("collect"===t){var o=this.props.collectList;o.forEach((function(t,n){if(a===t.id)if(0!==n){var s=o[n-1];e.getAudioStream(s,"collect"),e.props.sendCurSongInfo(s)}else C.show("\u5df2\u7ecf\u662f\u60a8\u6536\u85cf\u7684\u5b9d\u8d1d\u6b4c\u5355\u7684\u7b2c\u4e00\u9996\u5566",2e3)}))}else if("search"===t)for(var s=this.props.searchList,i=0;i<s.length;i++){if(s[i].id===a)if(0!==i){var r=s[i-1];this.getAudioStream(r,"search"),this.props.sendCurSongInfo(r)}else C.show("\u5df2\u7ecf\u662f\u60a8\u641c\u7d22\u7684\u5b9d\u8d1d\u6b4c\u5355\u7684\u7b2c\u4e00\u9996\u5566",2e3)}}},{key:"collectSongBySongId",value:function(){var e=this;if(this.props.authed){var t=this.props.curSongInfo.id;if(t){var a={method:"post",url:"/songs/collect.music",data:{userId:this.props.userInfo.id,songId:t}};console.log(t),S(a).then((function(t){console.log(t),0===t.data.code&&e.props.refreshCollectList()})).catch((function(e){console.log(e)}))}else C.show("\u6682\u65e0\u6b4c\u66f2\u64ad\u653e",2e3)}else C.show("\u6b64\u529f\u80fd\u9700\u767b\u5f55\u540e\u4f7f\u7528",2500)}},{key:"searchHandler",value:function(e){var t=this;S({data:{keyWords:e},method:"post",url:"/songs/searchByKeyWords.music"}).then((function(e){console.log(e);var a=e.data;0===a.code&&(a.songsList.length||C.show("Sorry\uff0c\u66f2\u5e93\u8fd8\u672a\u5f55\u5165\u60a8\u6240\u641c\u7d22\u7684\u6b4c\u66f2\ud83d\ude22",2500),t.props.setSearchResult(a.songsList))})).catch((function(e){console.log(e)}))}},{key:"durationChangeHandler",value:function(){}},{key:"loadMetaData",value:function(){this.setState({duration:this.refs.audio.duration}),console.log("loadMetaData")}},{key:"timeUpdateHandler",value:function(){this.setState({curTime:this.refs.audio.currentTime});var e=100*(this.refs.audio.currentTime/this.state.duration).toFixed(5);this.refs.processBar.style.width=e+"%"}},{key:"playTheSong",value:function(){console.log("playTheSong"),this.props.curSongInfo.id&&(this.refs.audio.play(),this.props.setPlayingState(1))}},{key:"pauseTheSong",value:function(){this.props.curSongInfo.id&&(this.refs.audio.pause(),this.props.setPlayingState(2))}},{key:"shareMusic",value:function(){console.log("share music")}}]),a}(n.Component),M=Object(d.b)((function(e){return e}),(function(e){return{setSearchResult:function(t){e({type:"searchList",searchList:t})},sendCurSongInfo:function(t){e({type:"curSongInfo",curSongInfo:t})},setPlayingState:function(t){e({type:"isPlaying",isPlaying:t})},sendCommentList:function(t){e({type:"commentList",commentList:t})},setMouseDown:function(t){e({type:"mouseDown",mouseStatus:t})}}}),null,{forwardRef:!0})(H),U=a(367),R=(a(313),U.a.Panel),q=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).mouseDownHandler=n.mouseDownHandler.bind(Object(h.a)(n)),n.mouseMoveHandler=n.mouseMoveHandler.bind(Object(h.a)(n)),n.mouseUpHandler=n.mouseUpHandler.bind(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return o.a.createElement(n.Fragment,null,o.a.createElement("div",{className:"item right right-list"},o.a.createElement("div",{className:"collection right-top"},o.a.createElement("h5",{className:"collect-title"},"\u6536\u85cf\u5217\u8868"),o.a.createElement("div",{className:"collection-list-container"},o.a.createElement("ul",{className:"collection-list"},this.props.state.collectList.map((function(t,a){return o.a.createElement("li",{onClick:e.playByName.bind(e,t,"collect"),key:a,className:e.props.state.curSongInfo.id===t.id?"songName active":""},o.a.createElement("span",{className:"collect-song-name"},t.fileNameChinese)," ","\u2014"," ",o.a.createElement("span",{className:"collect-album-name"},t.albumChinese))})),this.genHasNoCollect()))),o.a.createElement("div",{id:"drag",className:"right-middle",onMouseDown:this.mouseDownHandler,onMouseMove:this.mouseMoveHandler,onMouseUp:this.mouseUpHandler}),o.a.createElement("div",{className:"all-list right-bottom"},o.a.createElement("h5",{className:"all-list-title"},"\u5168\u90e8\u6b4c\u66f2"),o.a.createElement("div",{className:"all-list-container"},this.props.state.allList.map((function(t,a){return o.a.createElement(U.a,{className:"collapse",accordion:!0,key:a},o.a.createElement(R,{className:"panel",header:t.albumChinese},t.children.map((function(t,a){return o.a.createElement("p",{onClick:e.playByName.bind(e,t,"allList"),className:e.props.state.curSongInfo.id===t.id?"songName active":"songName",key:a},t.fileNameChinese)})),o.a.createElement("p",null,t.fileNameChinese)))}))))))}},{key:"componentDidMount",value:function(){0===this.props.state.allList.length&&this.getRightAllList()}},{key:"genHasNoCollect",value:function(){if(0===this.props.state.collectList.length)return this.props.state.userInfo.id?o.a.createElement("div",{className:"empty-collect"},"\u6682\u65e0"):o.a.createElement("div",{className:"empty-collect"},"\u8bf7\u767b\u5f55\u540e\u4f7f\u7528\u6b64\u529f\u80fd")}},{key:"playByName",value:function(e,t){var a=this.props.state.curSongInfo.id;e.id===a&&1===this.props.state.isPlaying||(this.props.playByUrl(e,t),this.props.sendCurSongInfo(e))}},{key:"getRightAllList",value:function(){var e=this,t={method:"post",url:"/songs/getCollectList.music",data:{userId:this.props.state.userInfo.id},showLoading:!0},a=S({method:"post",url:"/songs/getSongsList.music",showLoading:!0}),n=S(t);Promise.all([a,n]).then((function(t){var a=t[0].data.songsList;e.props.sendAllList(a),e.props.sendCurSongInfo(a[0].children[0]);var n="".concat(a[0].children[0].albumName,"/").concat(a[0].children[0].fileName);document.querySelector("#audio").src="/src/getSongStream.music?url="+n;var o=t[1].data.songsList;e.computeCollectList(a,o)})).catch((function(e){console.log(e)}))}},{key:"computeCollectList",value:function(e,t){for(var a=[],n=0;n<e.length;n++){e[n].children.forEach((function(e,n){t.forEach((function(t,n){e.id===t.songId&&(e.orderId=t.id,a.push(e))}))}))}var o=a.sort((function(e,t){return e.orderId-t.orderId}));this.props.sendCollectList(o)}},{key:"getCollectList",value:function(){var e=this,t={method:"post",url:"/songs/getCollectList.music",data:{userId:this.props.state.userInfo.id}};S(t).then((function(t){console.log(t.data);var a=t.data;0===a.code&&(console.log(e.props.state.allList),e.computeCollectList(e.props.state.allList,a.songsList))})).catch((function(e){console.log(e)}))}},{key:"mouseDownHandler",value:function(){console.log("mouseDownHandler")}},{key:"mouseMoveHandler",value:function(){console.log("mouseMoveHandler")}},{key:"mouseUpHandler",value:function(){console.log("mouseUpHandler")}}]),a}(n.Component),B=Object(d.b)((function(e){return{state:e}}),(function(e){return{sendCollectList:function(t){e({type:"collectList",collectList:t})},sendAllList:function(t){e({type:"allList",allList:t})},sendCurSongInfo:function(t){e({type:"curSongInfo",curSongInfo:t})}}}),null,{forwardRef:!0})(q),F=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).playByUrl=n.playByUrl.bind(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("div",{className:"main"},o.a.createElement("div",{className:"item player-container left"},o.a.createElement(M,{ref:"player",refreshCollectList:this.refreshCollectList.bind(this)})),o.a.createElement(B,{ref:"RightList",playByUrl:this.playByUrl}))}},{key:"searchCallByParent",value:function(e){this.refs.player.searchHandler(e)}},{key:"refreshCollectList",value:function(){console.log(this.refs),this.refs.RightList.getCollectList(),console.log("\u5237\u65b0\u6536\u85cf\u5217\u8868")}},{key:"playByUrl",value:function(e,t){console.log(t),this.props.sendCurSongInfo(e),this.refs.player.getAudioStream(e,t)}}]),a}(n.Component),D=Object(d.b)((function(e){return e}),(function(e){return{sendCurSongInfo:function(t){e({type:"curSongInfo",curSongInfo:t})}}}),null,{forwardRef:!0})(F),V=(a(316),a(30)),_=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("div",{className:"user-center"},o.a.createElement("p",{className:this.props.authed?"hide":"go-to-login",onClick:this.toLogin.bind(this)},"\u767b\u5f55"),o.a.createElement("div",{className:this.props.authed?"info-container":"hide"},o.a.createElement("span",{className:"nick-name"},this.props.userInfo.nickName),o.a.createElement("img",{className:"avatar",src:this.props.userInfo.avatar?this.props.userInfo.avatar:I.a,alt:"avatar"}),o.a.createElement("div",{className:"user-info-options"},o.a.createElement("ul",null,o.a.createElement("div",{className:"line-box"},o.a.createElement("li",null,o.a.createElement(V.b,{to:"/index"},o.a.createElement("i",{className:"iconfont icon-yinle"}),"\u53bb\u542c\u6b4c")),o.a.createElement("li",null,o.a.createElement("i",{className:"iconfont icon-xin1"}),"\u6211\u7684\u6536\u85cf"),o.a.createElement("li",null,o.a.createElement("i",{className:"iconfont icon-icon_good"}),"\u6211\u7684\u8d5e"),o.a.createElement("li",null,o.a.createElement("i",{className:"iconfont icon-pinglun"}),"\u6211\u53d1\u51fa\u7684\u8bc4\u8bba")),o.a.createElement("li",null,o.a.createElement("i",{className:"iconfont icon-bianji"}),o.a.createElement(V.b,{to:"/editUserInfo"},"\u4fee\u6539\u4e2a\u4eba\u4fe1\u606f")),o.a.createElement("li",{onClick:this.logout.bind(this)},o.a.createElement("i",{className:"iconfont icon-tuichu_huaban1"}),"\u9000\u51fa")))))}},{key:"toLogin",value:function(){this.props.goToLogin(!0),this.props.history.push("/login")}},{key:"logout",value:function(){this.props.history.push("/login"),this.props.setAuthed(!1)}}]),a}(n.Component),z=Object(d.b)((function(e){return e}),(function(e){return{goToLogin:function(t){e({type:"goToLogin",toLogin:t})},sendCurSongInfo:function(t){e({type:"curSongInfo",curSongInfo:t})},setAuthed:function(t){e({type:"authed",authed:t})}}}),null,{forwardRef:!0})(Object(m.g)(_)),W=(a(318),function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"header"},o.a.createElement("div",{className:"logo-container",onClick:function(){return e.props.history.push("/index")}},o.a.createElement("span",null,"\u6211\u611b")," ",o.a.createElement("img",{src:I.a,alt:""})," ",o.a.createElement("span",null,"\u5357\u4eac")),o.a.createElement("div",{className:"search-container"},o.a.createElement("input",{type:"text",id:"search-val",className:"search-input"}),o.a.createElement("button",{placeholder:"\u8bf7\u8f93\u5165\u4e13\u8f91\u540d\u6216\u6b4c\u540d",className:"search-btn",onClick:this.searchHandler.bind(this)},o.a.createElement("i",{className:"iconfont icon-search"},"\u641c\u7d22"))),o.a.createElement(z,null))}},{key:"searchHandler",value:function(){var e=this,t=document.querySelector("#search-val").value;t?(this.props.history.push("/index"),S({data:{keyWords:t},method:"post",url:"/songs/searchByKeyWords.music"}).then((function(t){console.log(t);var a=t.data;0===a.code&&(a.songsList.length||C.show("Sorry\uff0c\u66f2\u5e93\u8fd8\u672a\u5f55\u5165\u60a8\u6240\u641c\u7d22\u7684\u6b4c\u66f2\ud83d\ude22",2500),e.props.setSearchResult(a.songsList))})).catch((function(e){console.log(e)}))):C.show("\u8bf7\u8f93\u5165\u5173\u952e\u5b57",2500)}}]),a}(n.Component)),J=Object(d.b)((function(e){return e}),(function(e){return{setSearchResult:function(t){e({type:"searchList",searchList:t})}}}),null,{forwardRef:!0})(Object(m.g)(W)),G=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("div",{className:"index"},o.a.createElement(J,null),o.a.createElement(D,{ref:"main"}))}}]),a}(n.Component),K=(a(319),a(365)),X=a(363),Y=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={avatar:"",editNickNameStatus:!1,showModal:!1,canEditPassword:!1},n}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("div",{className:"index"},o.a.createElement(J,null),o.a.createElement("div",{className:"user-info"},o.a.createElement("div",{className:"content"},o.a.createElement("h3",{className:"title"},"\u4e2a\u4eba\u8d44\u6599"),o.a.createElement("div",{className:"items"},o.a.createElement("div",{className:"item avatar"},o.a.createElement("p",{className:"label avatar-title"},"\u5934\u50cf"),o.a.createElement("img",{ref:"avatar",src:this.props.userInfo.avatar,alt:"\u5934\u50cf"}),o.a.createElement("div",{className:"opt"},o.a.createElement("span",{className:"des"},"\u652f\u6301jpg\u3001png\u683c\u5f0f\uff0c\u5927\u5c0f\u4e3a5M\u4ee5\u5185\u7684\u56fe\u7247"),o.a.createElement("label",{className:"new-avatar-label",htmlFor:"new-avatar"},"\u9009\u62e9\u6587\u4ef6"),o.a.createElement("input",{onChange:this.handleAvatarIptChange.bind(this),type:"file",id:"new-avatar",accept:"image/jpg,image/png"}))),o.a.createElement("div",{className:"item nick-name"},o.a.createElement("p",{className:"label nick-name-title"},"\u7528\u6237\u540d"),o.a.createElement("p",{className:"detail"},this.props.userInfo.userName)),o.a.createElement("div",{className:"item nick-name"},o.a.createElement("p",{className:"label nick-name-title"},"\u6635\u79f0"),o.a.createElement("p",{className:"detail"},this.renderNickName()),o.a.createElement("div",{className:"btns-container"},o.a.createElement("span",{className:"edit-btn",onClick:this.editNickName.bind(this)},o.a.createElement("i",{className:"iconfont icon-bianji"},this.state.editNickNameStatus?"\u5b8c\u6210":"\u7f16\u8f91")),o.a.createElement("span",{className:this.state.editNickNameStatus?"cancel":"hide",onClick:this.setEditNickNameStatusFalse.bind(this)},o.a.createElement("i",{className:"iconfont icon-bianji"},"\u53d6\u6d88")))),o.a.createElement("div",{className:"item password"},o.a.createElement("p",{className:"label password-title"},"\u5bc6\u7801"),o.a.createElement(g.a,{onClick:this.showModal.bind(this),className:"confirm",type:"primary",size:"medium"},"\u4fee\u6539\u5bc6\u7801"))),o.a.createElement(K.a,{className:"modal",title:"\u4fee\u6539\u5bc6\u7801",visible:this.state.showModal,onCancel:this.hideModal.bind(this),footer:[o.a.createElement(g.a,{key:"back",onClick:this.hideModal.bind(this)},"\u53d6\u6d88"),o.a.createElement(g.a,{key:"submit",type:"primary",onClick:this.editPassword.bind(this)},"\u786e\u8ba4")]},o.a.createElement(X.a,{className:"space",direction:"vertical"},o.a.createElement("label",{htmlFor:"ori-password"},"\u8bf7\u8f93\u5165\u539f\u5bc6\u7801\uff1a"),o.a.createElement(f.a.Password,{className:"ipt",id:"ori-password",placeholder:"input password"}),o.a.createElement("label",{htmlFor:"new-password"},"\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801\uff1a"),o.a.createElement(f.a.Password,{className:"ipt",id:"new-password",placeholder:"input password"}),o.a.createElement("label",{htmlFor:"re-new-password"},"\u8bf7\u518d\u6b21\u8f93\u5165\u65b0\u5bc6\u7801\uff1a"),o.a.createElement(f.a.Password,{className:"ipt",id:"re-new-password",placeholder:"input password",onChange:this.checkNewPassword.bind(this)}))))))}},{key:"componentDidMount",value:function(){this.setState({avatar:I.a})}},{key:"setEditNickNameStatusFalse",value:function(){this.setState({editNickNameStatus:!1})}},{key:"checkNewPassword",value:function(){if(document.querySelector("#new-password").value.toString()!==document.querySelector("#re-new-password").value.toString())return C.show("\u4e24\u6b21\u5bc6\u7801\u8f93\u5165\u4e0d\u4e00\u81f4",2500),void this.setState({canEditPassword:!1});this.setState({canEditPassword:!0})}},{key:"editPassword",value:function(){var e=this;if(this.state.canEditPassword){var t={method:"post",url:"/users/edit_password.music",data:{oldPwd:j()(document.querySelector("#ori-password").value.toString()),reNewPassword:j()(document.querySelector("#re-new-password").value.toString()),userId:this.props.userInfo.id}};S(t).then((function(t){console.log(t),0===t.data.code?(C.show("\u4fee\u6539\u5bc6\u7801\u6210\u529f",2500),e.hideModal()):4===t.data.code&&C.show("\u539f\u5bc6\u7801\u8f93\u5165\u6709\u8bef",2500)})).catch((function(e){C.show("\u4fee\u6539\u5bc6\u7801\u5931\u8d25",2500),console.log(e)}))}else C.show("\u4e24\u6b21\u5bc6\u7801\u8f93\u5165\u4e0d\u4e00\u81f4",2500)}},{key:"getUserInfo",value:function(){var e=this,t={method:"post",url:"/users/get_userInfo.music",data:{userId:this.props.userInfo.id}};S(t).then((function(t){0===t.data.code&&e.props.setUserInfo(t.data.data),console.log(t)})).catch((function(e){C.show("\u83b7\u53d6\u4fe1\u606f\u5931\u8d25",2500),console.log(e)}))}},{key:"renderNickName",value:function(){return this.state.editNickNameStatus?o.a.createElement("span",null,o.a.createElement("input",{onChange:this.nickNameChange.bind(this)})):o.a.createElement("span",null,this.props.userInfo.nickName)}},{key:"nickNameChange",value:function(e){var t=e.currentTarget.value;this.setState({nickName:t})}},{key:"editNickName",value:function(){var e=this,t=this.state.nickName,a=this.state.editNickNameStatus;if(this.setState({editNickNameStatus:!a}),a){var n={method:"post",url:"/users/edit_nickName.music",data:{userId:this.props.userInfo.id,nickName:t}};S(n).then((function(t){0===t.data.code&&(C.show("\u6210\u529f",1e3),e.getUserInfo())})).catch((function(e){C.show("\u4fee\u6539\u6635\u79f0\u5931\u8d25",2500),console.log(e)}))}}},{key:"handleAvatarIptChange",value:function(e){var t=this,a=e.currentTarget.files[0];if(a.size/1024/1024>5)C.show("\u56fe\u7247\u5927\u4e8e5M",2e3);else{var n,o=new FileReader;o.readAsDataURL(a),o.onload=function(){n=o.result,t.uploadAvatar(n)}}}},{key:"uploadAvatar",value:function(e){var t=this,a={method:"post",url:"users/edit_avatar.music",data:{userId:this.props.userInfo.id,url:e}};S(a).then((function(e){0===e.data.code&&(C.show("\u4fee\u6539\u6210\u529f",2e3),t.getUserInfo())})).catch((function(e){console.log(e)}))}},{key:"hideModal",value:function(){this.setState({showModal:!1})}},{key:"showModal",value:function(){this.setState({showModal:!0})}}]),a}(n.Component),Q=[{key:"LoginAndRegister",path:"/login",requiresAuth:!1,component:P},{key:"Register",path:"/register",requiresAuth:!1,component:P},{key:"Index",path:"/index",requiresAuth:!1,component:G},{key:"EditUserInfo",path:"/editUserInfo",requiresAuth:!0,component:Object(d.b)((function(e){return e}),(function(e){return{setUserInfo:function(t){e({type:"userInfo",userInfo:t})}}}),null,{forwardRef:!0})(Y)}],Z=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e?o.a.createElement(m.d,n,e.map((function(e,n){return o.a.createElement(m.b,{key:e.key||n,path:"/player"+e.path,exact:e.exact,render:function(n){return!e.requiresAuth||t||e.path===a?o.a.createElement(e.component,Object.assign({},n,{route:e})):o.a.createElement(m.a,{to:{pathname:a,state:{from:n.location}}})}})}))):null},$=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={authed:!1},n}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement(m.d,null,Z(Q,this.props.authed,"/login"))))}},{key:"componentDidMount",value:function(){console.log(this.props)}}]),a}(n.Component),ee=Object(d.b)((function(e){return e}),null,null,{forwardRef:!0})(Object(m.g)($)),te=a(36),ae={collectList:[],allList:[],curSongInfo:{},playerCom:{optionMenus:[{option:"collect",iconfont:"icon-xin",toolTip:"\u6536\u85cf"},{option:"prev",iconfont:"icon-shangyishou",toolTip:"\u4e0a\u4e00\u9996"},{option:"play big",iconfont:"icon-bofang",toolTip:"\u64ad\u653e"},{option:"paused big",iconfont:"icon-zanting1",toolTip:"\u6682\u505c"},{option:"next",iconfont:"icon-xiayishou",toolTip:"\u4e0b\u4e00\u9996"}]},isPlaying:2,searchList:[],userInfo:{},commentList:[],mouseStatus:2,authed:!1,toLogin:!1},ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae,t=arguments.length>1?arguments[1]:void 0,a=JSON.parse(JSON.stringify(e));switch(t.type){case"allList":return a.allList=t.allList,a;case"collectList":return a.collectList=t.collectList,a;case"curSongInfo":return a.curSongInfo=t.curSongInfo,a;case"searchList":return a.searchList=t.searchList,a;case"userInfo":return a.userInfo=t.userInfo,a;case"isPlaying":return a.isPlaying=t.isPlaying,a;case"commentList":return a.commentList=t.commentList,a;case"authed":return a.authed=t.authed,a;case"mouseDown":return a.mouseStatus=t.mouseStatus,a;case"goToLogin":return a.toLogin=t.toLogin,a;default:return e}},oe=a(110),se=a(175),ie=a.n(se),re=a(176),le={key:"root",storage:a.n(re).a,stateReconciler:ie.a},ce=Object(oe.a)(le,ne),ue=Object(te.c)(ce),me=Object(oe.b)(ue),de=ue,he=a(177);window.httpRequest=S,i.a.render(o.a.createElement(V.a,null,o.a.createElement(d.a,{store:de},o.a.createElement(he.PersistGate,{loading:null,persistor:me},o.a.createElement(m.b,{path:"/",component:ee})))),document.getElementById("root"))}},[[180,1,2]]]);
//# sourceMappingURL=main.ff8c9cd8.chunk.js.map